

在常见的**线性 dp** 当中，整个过程随着阶段在每个状态维度上不断扩展。比如常见的背包dp - $f(i, j)$ 随着 i 阶段在 j 的维度上不断扩展，直到求出最终答案。

在任何时刻，已经求出的状态和未求出的状态在各维度上的分界点形成了 dp 扩展的轮廓。

在 dp 中存在一类问题，需要在状态中记录一个**集合**，保存轮廓的详细信息，便于状态转移。如果该集合大小不超过 N，且每个元素都是小于 k 的自然数，那么我们可以通过一个 N 位的 K 进制数来表示该集合，并且作为状态的一维出现。这种将**集合转换为整数记录在 dp 状态中**的一类算法被称为状压dp。


> 第一类题目：**填充网格图形** 类题目

该类题目的特点是**填充图形仅与相邻的若干行有关**，容易按照“行号”划分阶段，从而应用 状压 dp 算法。


[acwing 291. 蒙德里安的梦想](https://www.acwing.com/problem/content/description/293/)

本题将 $n*m$ 的棋盘分割成 1*2 的长方形。长方形有两种形式：横着放和竖着放。

朴素做法可以通过枚举每个点的每个选择，来判断方案是否合理，时间复杂度达到 $2^{nm}$ ，超时。

仔细观察会发现，在枚举每一行的时候，第 i 行会受到第 i-1 行的竖着放着的影响。而第 i-1 行横着放的对第 i 行没有影响。

因此，我们可以根据第 i-1 行竖着放的来快速得到第 i 行的摆放情况。由于 n 和 m 很小。

那么，我们可以通过 $[0, 2^m-1]$ 来表示该行每个位置是竖着放还是横着放。

$f(i, state)$ 就是状态。 $f(0, 0) = 1$, $f(n, 0)$ 就是答案。

那么状态转移方程是什么？

$f(i, state) += f(i, k)$ 

- k 和 state 的任何一位不能同时为 1，也就是按位与为 0
- state的横着的位置，每一段必须是偶数个，因为长为 2。所以 k 和 state 按位或之后的连续 0 都是偶数个。

在这里，我们可以通过预处理优化第二步，求出合法连续 0 为偶数个的所有可能状态。


[acwing 292. 炮兵阵地](https://www.acwing.com/problem/content/description/294/)

朴素做法枚举每个点，然后分别判断是否放还是不放，时间复杂度为 $O(2^{nm})$

仔细观察，我们发现第 i 行的点会受到第 i-1 行和第 i-2 行影响。

将每一行的状态看成是一个 $m$ 位的二进制，1 表示放置， 0 表示没有防止。

- 对于每个状态来讲，相邻两个 1 的距离不小于 3，因此可以提前预处理出所有的合法状态。
- 对于每一行来讲，山地不能放置，因此可以提前处理好山地情况，用一个 m 位二进制表示山地情况，1 表示山地， 0 表示不是。

$f(i, j, k)$ 表示前 i 行，第 i 行状态为 j ，第 i-1 行状态为 k 的最大放置数量。

$$
f(i, j, k) = max(f(i-1, k, l)) + count(i)
$$

其中要求：
`j&k = 0, k & l = 0, j & l = 0`, 且 $valid(i, j), valid(i-1, k)$ 都合法。

这里不需要判断 $valid(i-2, l)$,因为该状态如果不合法，会被直接淘汰掉。

初始化：$f(0, 0, 0) = 0$, 其余为 -INF.

答案: $max(f(n, j, k)), j , k 合法$。

时间复杂度原始为 $O(N*8^M)$, 通过题目特殊性将时间复杂度降低为 $O(NS^3)$, S 表示合法的状态（也就是相邻 1 的距离不少于 3 的状态个数，大概在 100 个左右）。


解法二：更通用的状压 dp

将每行状态压缩成一个 M 位的三进制数。$[0, 3^M)$

- 数字 2 表示放置，2 下面必须是 1，1 下面必须是 0，只有 0 的下边可以放置新的炮兵。

$f(i, j)$ 表示第 i 行的压缩后状态是 j 时，最多放置个数。状态规模是 $O(N*3^M)$。

如何转移：
- 第 i 行第 j 列是 2 时，第 i+1 行第 j 列一定是 1
- 第 i 行第 j 列是 1 时，第 i+1 行第 j 列一定是 0
- 山地不能填 2
- 一个格子填 2 后，右边的两个格子不能填 2

对于这列状态表示比较复杂的题目，不一定要写出确切的状态转移方程。可以通过 dfs 保证上述四个条件下，确定第 i+1 行的状态。也就是在相邻两行之间通过 dfs 进行转移。









































































































































































































































































































































































































