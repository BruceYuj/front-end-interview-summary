
## 浏览器的趋势

1. 应用程序 Web 化：云计算和 H5 技术快速发展，很多应用转向 B/S 架构
2. Web 应用移动化：开发方便，移动端通过 webview 开发应用，PWA 期望解决 web 和原生应用各自优势
3. Web 操作系统化
   - chromeOS，利用 web 技术构建纯粹的操作系统
   - 浏览器底层结构往操作系统架构方向发展。也就是成为操作系统上面的 "OS"
     - 也就是朝着 SOA（面向服务的架构），更多模块以服务形式提供给上层使用
     - 引入 assembly，支持多种编程语言
     - 简化渲染流程
     - 加大对系统设备特性支持
     - 支撑复杂 web 项目的开发

## 浏览器的占比
[statcounter](https://gs.statcounter.com/browser-market-share/)

总体来讲：
1. global：
   - chrome 占 62%，safari 占 20%
2. china:
   - chrome 接近一半，UC 和 QQ 加起来 22%，safari 10%

## 学习浏览器工作原理原因
1. 准确评估 web 项目可行性
2. 更高维度审视页面性能，更好理解最佳实践
3. 把握快节奏技术迭代中的本质

## 主流浏览器的排版引擎
1. Chrome：Blink，由webkit分支中的 webCore 独立出来
2. Safari：Webkit 中的 webcore，webkit包含 webcore 和 JavaScriptCore（JS engine）
3. Firefox：Gecko

三个排版引擎(layout engine)的渲染流水线类似，但是具体实现差别比较大。

[更多简介](https://www.cnblogs.com/guanghe/p/5948415.html)

## chrome 的多进程架构
在2008年,chrome 提出多进程架构基本出于以下几点原因：
1. webkit 属于 apple，公司之间的信任问题
2. webkit在当时很多内存泄露，多进程能够很大程度避免。因为一个进程关了，所有该进程的内存会被回收
3. 安全性更好。单进程多线程在于共享内存空间导致隔离不足，bug很容易扩散，可能导致全面崩溃。而多进程架构强制要求 IPC 通信，类似于开启了进程间防火墙。
4. webkit当时很多全局变量，如果一个页面一个线程理论上不好搞。最开始有考虑过单进程多线程模式，后来被舍弃。不过该方案在移动端有优势（基于手机性能和内存原因），因此最开始 android chromium 就是单进程模式（现在是多进程）。
5. 传统的浏览器被设计为显示网页，而Chrome的设计目标是支撑“web app”（当时js和相关技术已经很发达，并且Gmail等服务很成功）。这就需要Chrome 提供一个类似于OS的架构，支持复杂APP的运行。而如果 APP变得复杂，就难以避免出现bug，然后 crash。同时浏览器可能面临恶意代码，浏览器需要考虑恶意代码是否会攻击浏览器的渲染引擎。因此单进程的架构不太满足要求。

因此，Chrome将**隔离性**作为基本的设计原则，用进程的隔离性来实现对APP隔离：
- 一个 web app crash 不会导致其他所有的 web app crash（稳定性）
- 一个web app 可以以某种形式访问其他APP数据（安全性）
- web app 之间是并行的，可以提供更好响应（性能），这个多线程也能做到

> 也就是更多的工程思维的方式问题。初级者可能直觉上认为 thread 比 process更加高级、轻量、性能也更好，所以应该使用多线程。但是架构师会思考：想解决的是复杂系统的安全和错误处理。最好的方式就是严格隔离。而实现隔离的最自然方式是用多进程。但是多进程有一些问题，所以我们保证我们这么设计的同时能够最大程度避免这些问题。也就是说，我们要抓住问题的核心，然后围绕核心方案再去考虑一些小问题。
> 另外是处理错误的方式。一般开发者认为稳定性是要兜底，保证出现问题时程序能够继续运行，只要不挂就可以。但是这是有使用场景的。因为某些异常做出的事是程序无法控制的，比如乱写磁盘文件，乱发非法请求。而这是浏览器无法接受的，因此一旦出现这类问题，crash它就是最好方法。这些是window 蓝屏或者 ios app 闪退考虑的处理因素之一。高可靠的系统需要把高度危险和不可控非常高的部分隔离出去。Erlang将这个设计理念完全纳入了语言和OTP的设计中。

- [chrome multi-process architecture,08](https://blog.chromium.org/2008/09/multi-process-architecture.html)
- [chrome design document](https://www.chromium.org/developers/design-documents)


单进程真的比多进程有性能优势吗？（前提是页面不多不复杂的时候）
> 理论上来讲，性能会有些许优势。但是你站在更高的角度上这些性能损耗是微不足道的。

另外对于现代计算机来讲，往往都是多CPU多核或者单CPU多核的。线程的效率并不一定比进程高。
